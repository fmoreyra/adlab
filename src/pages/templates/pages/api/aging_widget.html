<!-- Aging Widget HTMX Response Template -->
<div class="space-y-6">
    {% if error %}
        <div class="text-center py-8">
            <div class="text-red-600 text-lg font-medium">⚠️ Error</div>
            <div class="text-gray-600 text-sm mt-1">{{ error }}</div>
        </div>
    {% else %}
        <!-- Aging Distribution -->
        <div>
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Distribución por Edad</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="metric-card">
                    <div class="metric-value text-green-600">{{ por_rango.0_3_dias }}</div>
                    <div class="metric-label">0-3 días</div>
                </div>
            <div class="metric-card">
                <div class="metric-value text-yellow-600">{{ por_rango.4_7_dias }}</div>
                <div class="metric-label">4-7 días</div>
            </div>
            <div class="metric-card">
                <div class="metric-value text-orange-600">{{ por_rango.8_14_dias }}</div>
                <div class="metric-label">8-14 días</div>
            </div>
            <div class="metric-card">
                <div class="metric-value text-red-600">{{ por_rango.mas_14_dias }}</div>
                <div class="metric-label">+14 días</div>
            </div>
        </div>
    </div>

    <!-- Aging Chart -->
    <div class="chart-container">
        <div class="text-center">
            <div class="text-lg font-medium text-gray-700 mb-4">Distribución de Edad de Muestras</div>
            <div class="flex justify-center items-end gap-2 h-32">
                <div class="flex flex-col items-center">
                    <div class="w-12 bg-green-500 rounded-t" style="height: {{ por_rango.0_3_dias|floatformat:0|add:0|add:por_rango.0_3_dias|floatformat:0|add:por_rango.0_3_dias|floatformat:0 }}px;"></div>
                    <div class="text-xs text-gray-600 mt-2">0-3</div>
                    <div class="text-xs font-medium">{{ por_rango.0_3_dias }}</div>
                </div>
                <div class="flex flex-col items-center">
                    <div class="w-12 bg-yellow-500 rounded-t" style="height: {{ por_rango.4_7_dias|floatformat:0|add:0|add:por_rango.4_7_dias|floatformat:0|add:por_rango.4_7_dias|floatformat:0 }}px;"></div>
                    <div class="text-xs text-gray-600 mt-2">4-7</div>
                    <div class="text-xs font-medium">{{ por_rango.4_7_dias }}</div>
                </div>
                <div class="flex flex-col items-center">
                    <div class="w-12 bg-orange-500 rounded-t" style="height: {{ por_rango.8_14_dias|floatformat:0|add:0|add:por_rango.8_14_dias|floatformat:0|add:por_rango.8_14_dias|floatformat:0 }}px;"></div>
                    <div class="text-xs text-gray-600 mt-2">8-14</div>
                    <div class="text-xs font-medium">{{ por_rango.8_14_dias }}</div>
                </div>
                <div class="flex flex-col items-center">
                    <div class="w-12 bg-red-500 rounded-t" style="height: {{ por_rango.mas_14_dias|floatformat:0|add:0|add:por_rango.mas_14_dias|floatformat:0|add:por_rango.mas_14_dias|floatformat:0 }}px;"></div>
                    <div class="text-xs text-gray-600 mt-2">+14</div>
                    <div class="text-xs font-medium">{{ por_rango.mas_14_dias }}</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Overdue Samples -->
    {% if protocolos_vencidos %}
    <div>
        <h3 class="text-lg font-semibold text-red-800 mb-4">Muestras Vencidas</h3>
        <div class="space-y-2">
            {% for protocolo in protocolos_vencidos %}
            <div class="overdue-item">
                <div class="overdue-info">
                    <div class="overdue-protocol">{{ protocolo.protocolo_numero }}</div>
                    <div class="overdue-details">
                        {{ protocolo.animal }} - {{ protocolo.veterinario }}
                        <span class="ml-2 text-xs bg-gray-200 px-2 py-1 rounded">{{ protocolo.estado }}</span>
                    </div>
                </div>
                <div class="overdue-days">{{ protocolo.dias_desde_recepcion }} días</div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% else %}
    <div class="text-center py-8">
        <div class="text-green-600 text-lg font-medium">✅ No hay muestras vencidas</div>
        <div class="text-gray-600 text-sm mt-1">Todas las muestras están dentro del TAT objetivo</div>
    </div>
    {% endif %}
    {% endif %}
</div>
